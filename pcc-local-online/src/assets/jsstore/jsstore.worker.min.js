/*!
 * @license :jsstore - V4.0.1 - 19/04/2023
 * https://github.com/ujjwalguptaofficial/JsStore
 * Copyright (c) 2023 @Ujjwal Gupta; Licensed MIT
 */
var JsStoreWorker=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}({3:function(e,t,n){"use strict";var r,o,i,u,s,a,c,l,h;n.r(t),n.d(t,"QueryManager",(function(){return ht})),function(e){e.UndefinedColumn="undefined_column",e.UndefinedValue="undefined_value",e.UndefinedColumnName="undefined_column_name",e.UndefinedDbName="undefined_database_name",e.UndefinedColumnValue="undefined_column_value",e.NotArray="not_array",e.NoValueSupplied="no_value_supplied",e.ColumnNotExist="column_not_exist",e.EnableSearchOff="enable_search_off",e.InvalidOp="invalid_operator",e.NullValue="null_value",e.WrongDataType="wrong_data_type",e.TableNotExist="table_not_exist",e.DbNotExist="db_not_exist",e.ConnectionAborted="connection_aborted",e.ConnectionClosed="connection_closed",e.NotObject="not_object",e.InvalidConfig="invalid_config",e.DbBlocked="Db_blocked",e.IndexedDbNotSupported="indexeddb_not_supported",e.NullValueInWhere="null_value_in_where",e.InvalidJoinQuery="invalid_join_query",e.InvalidOrderQuery="invalid_order_query",e.InvalidQuery="invalid_query",e.InvalidGroupQuery="invalid_group_query",e.ImportScriptsFailed="import_scripts_failed",e.MethodNotExist="method_not_exist",e.Unknown="unknown"}(r||(r={})),function(e){e.Registered="registerd",e.Failed="failed",e.NotStarted="not_started"}(o||(o={})),function(e){e.String="string",e.Object="object",e.Array="array",e.Number="number",e.Boolean="boolean",e.Null="null",e.DateTime="date_time"}(i||(i={})),function(e){e.InitDb="init_db",e.Get="get",e.Set="set",e.Select="select",e.Insert="insert",e.Update="update",e.Remove="remove",e.OpenDb="open_db",e.Clear="clear",e.DropDb="drop_db",e.Count="count",e.ChangeLogStatus="change_log_status",e.Terminate="terminate",e.Transaction="transaction",e.CloseDb="close_db",e.Union="union",e.Intersect="intersect",e.ImportScripts="import_scripts"}(u||(u={})),function(e){e.RequestQueueEmpty="requestQueueEmpty",e.RequestQueueFilled="requestQueueFilled"}(s||(s={})),function(e){e.Where="where",e.Like="like",e.Regex="regex",e.In="in",e.Equal="=",e.Between="-",e.GreaterThan=">",e.LessThan="<",e.GreaterThanEqualTo=">=",e.LessThanEqualTo="<=",e.NotEqualTo="!=",e.Aggregate="aggregate",e.Max="max",e.Min="min",e.Avg="avg",e.Count="count",e.Sum="sum",e.Or="or",e.Skip="skip",e.Limit="limit",e.And="and",e.IgnoreCase="ignoreCase",e.Then="then"}(a||(a={})),function(e){e.ReadOnly="readonly",e.ReadWrite="readwrite"}(c||(c={})),function(e){e.First="f",e.Last="l",e.Any="a"}(l||(l={})),function(e){e.Connected="connected",e.Closed="closed",e.NotStarted="not_started",e.UnableToStart="unable_to_start",e.ClosedByJsStore="closed_by_jsstore"}(h||(h={}));var f,p=function(e){return new Promise(e)};!function(e){e.Create="create",e.Delete="delete"}(f||(f={}));var d,y=function(){function e(e,t){this.autoIncColumnValue={};var n=[];for(var r in e.columns){var o=e.columns[r];o.name=r,o.autoIncrement&&(this.autoIncColumnValue[r]=0),o.primaryKey&&(this.primaryKey=r),o.enableSearch=null==o.enableSearch||o.enableSearch,n.push(o)}this.columns=n,this.name=e.name,this.version=e.version||1,t>this.version&&(this.version=t),this.setState_()}return e.prototype.setState_=function(){this.state=f.Create},e}(),v=function(){function e(){}return e.autoIncrementKey=function(e,t){return"JsStore_"+e+"_"+t+"_Value"},e.set=function(t,n,r){r.tx||r.createTransaction([e.tableName]);var o=r.objectStore(e.tableName);return p((function(e,r){var i=o.put({key:t,value:n});i.onsuccess=function(){e()},i.onerror=r}))},e.get=function(t,n){n.tx||n.createTransaction([e.tableName]);var r=n.objectStore(e.tableName);return p((function(e,o){var i=r.get(n.keyRange(t));i.onsuccess=function(){var t=i.result;e(t&&t.value)},i.onerror=o}))},e.remove=function(t,n){n.tx||n.createTransaction([e.tableName]);var r=n.objectStore(e.tableName);return p((function(e,o){var i=r.delete(n.keyRange(t));i.onsuccess=e,i.onerror=o}))},e.tableName="JsStore_Meta",e.dbSchema="JsStore_DbSchema",e}(),b=function(e){this.name=e.name,e.tables.push({name:v.tableName,columns:{key:{primaryKey:!0},value:{enableSearch:!1}}}),this.tables=e.tables.map((function(t){return new y(t,e.version)})),this.version=e.version||1},m=function(){function e(e){this.db=e}return e.prototype.emptyTx=function(){this.tx&&(this.tx.oncomplete=null,this.tx.onabort=null,this.tx.onerror=null,this.tx=null)},e.prototype.createTransaction=function(e,t){var n=this;return void 0===t&&(t=c.ReadWrite),this.tx=this.con.transaction(e,t),p((function(e,t){n.tx.oncomplete=e,n.tx.onabort=e,n.tx.onerror=t}))},e.prototype.keyRange=function(e,t){var n;switch(t){case a.Between:n=IDBKeyRange.bound(e.low,e.high,!1,!1);break;case a.GreaterThan:n=IDBKeyRange.lowerBound(e,!0);break;case a.GreaterThanEqualTo:n=IDBKeyRange.lowerBound(e);break;case a.LessThan:n=IDBKeyRange.upperBound(e,!0);break;case a.LessThanEqualTo:n=IDBKeyRange.upperBound(e);break;default:n=IDBKeyRange.only(e)}return n},e.prototype.objectStore=function(e){return this.tx.objectStore(e)},e.prototype.abortTransaction=function(){this.tx&&this.tx.abort()},e.prototype.close=function(){var e=this;return this.con&&this.con.close(),p((function(t){e.con=null,setTimeout(t,100)}))},e.prototype.initDb=function(){var e=this,t=this.db,n=!1;return p((function(r,o){var i=indexedDB.open(t.name,t.version);i.onsuccess=function(){e.con=i.result,e.con.onversionchange=function(e){e.target.close()},r(n)},i.onerror=function(e){console.error("error",e),o(e)},i.onupgradeneeded=function(e){var r=e.target.result;n=!0;var o=[f.Create,f.Delete];t.tables.forEach((function(e){o.indexOf(e.state)>=0&&function(e){var t=e.primaryKey?{keyPath:e.primaryKey}:{autoIncrement:!0};r.objectStoreNames.contains(e.name)&&r.deleteObjectStore(e.name);var n=r.createObjectStore(e.name,t);e.columns.forEach((function(e){if(e.enableSearch){var t=e.name,r=e.primaryKey?{unique:!0}:{unique:e.unique};r.multiEntry=e.multiEntry;var o=null==e.keyPath?t:e.keyPath;n.createIndex(t,o,r)}}))}(e)}))}}))},e}(),g=function(e){return Promise.all(e)},_=function(e){return Promise.reject(e)},w=function(){function e(e,t){void 0===t&&(t=null),this.type=e,this.info_=t,this.message=this.getMsg_()}return e.prototype.throw=function(){throw this.get()},e.prototype.log=function(e){console.log(e)},e.prototype.logError=function(){console.error(this.get())},e.prototype.get=function(){return{message:this.message,type:this.type}},e.prototype.getMsg_=function(){var e;switch(this.type){case r.NotArray:e="Supplied value is not an array";break;case r.UndefinedColumn:e="Column is undefined in Where";break;case r.UndefinedValue:e="Value is undefined in Where";break;case r.UndefinedColumnName:e="Column name is undefined '"+this.info_.TableName+"'";break;case r.UndefinedDbName:e="Database name is not supplied";break;case r.UndefinedColumnValue:e="Column value is undefined";break;case r.NoValueSupplied:e="No value is supplied";break;case r.InvalidOp:e="Invalid Op Value '"+this.info_.Op+"'";break;case r.ColumnNotExist:e=this.info_.isOrder?"Column '"+this.info_.column+"' in order query does not exist":"Column '"+this.info_.column+"' does not exist";break;case r.EnableSearchOff:e="Search is turned off for the Column '"+this.info_.column+"'";break;case r.NullValue:e="Null value is not allowed for column '"+this.info_.ColumnName+"'";break;case r.WrongDataType:e="Supplied value for column '"+this.info_.column+"' have wrong data type";break;case r.TableNotExist:e="Table '"+this.info_.tableName+"' does not exist";break;case r.DbNotExist:e="Database with name "+this.info_.dbName+" does not exist";break;case r.NotObject:e="supplied value is not object";break;case r.InvalidOp:e="Invalid Config '"+this.info_.Config+" '";break;case r.DbBlocked:e="database is blocked, cant be deleted right now";break;case r.NullValueInWhere:e="Null/undefined is not allowed in where. Column '"+this.info_.column+"' has null";break;case r.MethodNotExist:e="method "+this.info_+" does not exist.";break;case r.IndexedDbNotSupported:e="Browser does not support indexeddb";break;case r.InvalidJoinQuery:case r.InvalidGroupQuery:case r.InvalidOrderQuery:case r.ImportScriptsFailed:e=this.info_;break;default:this.type||(this.type=r.Unknown),e=this.message}return e},e}(),x=function(e){if(e instanceof w)return e.logError(),e.get();var t=void 0;return e.name?(t=new w(e.name)).message=e.message:(t=new w(e.target.error.name)).message=e.target.error.message,t.get()},k=function(){function e(){this.rowAffected=0,this.isTxQuery=!1,this.results=[]}return e.prototype.table=function(e){var t=e||this.tableName;return this.db.tables.find((function(e){return e.name===t}))},e.prototype.primaryKey=function(e){return this.table(e).primaryKey},e.prototype.getColumnInfo=function(e,t){return this.table(t).columns.find((function(t){return t.name===e}))},e.prototype.onException=function(e,t){return console.error(e),this.util.abortTransaction(),_(function(e,t){return void 0===t&&(t=r.InvalidQuery),e.name=t,x(e)}(e,t))},e}(),E=function(e){if(null==e)return i.Null;var t=typeof e;switch(t){case"object":if(Array.isArray(e))return i.Array;if(e instanceof Date)return i.DateTime}return t},T=function(e){if(null==e)return!0;switch(typeof e){case"string":return 0===e.length;case"number":return isNaN(e)}return!1},q=function(){function e(e,t){this.table=e,this.autoIncrementValue=t}return e.prototype.checkAndModifyValues=function(e){var t,n=this;return e.every((function(e){return!(t=n.checkAndModifyValue(e))})),{err:t,values:e}},e.prototype.checkAndModifyValue=function(e){var t,n=this;return this.table.columns.every((function(r){return!(t=n.checkAndModifyColumnValue_(r,e))})),t},e.prototype.checkNotNullAndDataType_=function(e,t){return e.notNull&&T(t[e.name])?this.getError(r.NullValue,{ColumnName:e.name}):e.dataType&&!T(t[e.name])&&E(t[e.name])!==e.dataType?this.getError(r.WrongDataType,{column:e.name}):void 0},e.prototype.checkAndModifyColumnValue_=function(e,t){var n=t[e.name];return e.autoIncrement?T(n)?t[e.name]=++this.autoIncrementValue[e.name]:E(n)===i.Number&&n>this.autoIncrementValue[e.name]&&(this.autoIncrementValue[e.name]=n):void 0!==e.default&&T(n)&&(t[e.name]=e.default),this.checkNotNullAndDataType_(e,t)},e.prototype.getError=function(e,t){return new w(e,t)},e}(),S=function(){function e(e){this.table=e}return e.prototype.check=function(e,t){var n,o=this;return typeof e===i.Object?this.table?this.table.columns.every((function(t){return t.name in e&&(n=o.checkByColumn_(t,e[t.name])),!n})):n=new w(r.TableNotExist,{tableName:t}):n=new w(r.NotObject),n},e.prototype.checkByColumn_=function(e,t){if(!0===e.notNull&&T(t))return new w(r.NullValue,{ColumnName:e.name});var n=E(t),o=null!=t;if(e.dataType&&o&&n!==e.dataType&&"object"!==n)return new w(r.WrongDataType,{column:e.name});if(o&&"object"===n){var i=["+","-","*","/","{push}"];for(var u in t)if(i.indexOf(u)<0&&e.dataType&&n!==e.dataType)return new w(r.WrongDataType,{column:e.name})}},e}(),C=function(){function e(e){this.db=e}return e.prototype.validate=function(e,t){switch(e){case u.Select:case u.Remove:case u.Count:return this.checkSelect(t);case u.Insert:return this.checkInsertQuery(t);case u.Update:return this.checkUpdate(t)}},e.prototype.getTable_=function(e){return this.db.tables.find((function(t){return t.name===e}))},e.prototype.isInsertQryValid_=function(e){var t,n=this.getTable_(e.into);if(n)switch(E(e.values)){case i.Array:break;case i.Null:t=new w(r.NoValueSupplied);break;default:t=new w(r.NotArray)}else t=new w(r.TableNotExist,{tableName:e.into});return{table:n,log:t}},e.prototype.checkUpdate=function(e){var t=new S(this.getTable_(e.in)).check(e.set,e.in);if(t)return t;if(null!=e.where){if(t=this.checkForNullInWhere_(e))return t;this.addGreatAndLessToNotOp_(e)}},e.prototype.checkSelect=function(e){if(!this.getTable_(e.from))return new w(r.TableNotExist,{tableName:e.from});if(e.where){var t=this.checkForNullInWhere_(e);if(t)return t;this.addGreatAndLessToNotOp_(e)}},e.prototype.checkForNullInWhere_=function(e){for(var t in e.where)if(null==e.where[t])return new w(r.NullValueInWhere,{column:t})},e.prototype.addGreatAndLessToNotOp_=function(e){var t=e.where,n=function(e,t){return t.findIndex((function(t){return null!=e[t][a.NotEqualTo]}))>=0},r=function(e,t){var n;return t.forEach((function(t){null!=(n=e[t])[a.NotEqualTo]&&(e[t][a.GreaterThan]=n[a.NotEqualTo],void 0===e[a.Or]?(e[a.Or]={},e[a.Or][t]={}):void 0===e[a.Or][t]&&(e[a.Or][t]={}),e[a.Or][t][a.LessThan]=n[a.NotEqualTo],delete e[t][a.NotEqualTo])})),e};switch(E(t)){case i.Object:var o=Object.keys(t);if(n(t,o))if(1===o.length)e.where=r(t,o);else{var u=[];o.forEach((function(e){var n;u.push(r(((n={})[e]=t[e],n),[e]))})),e.where=u}break;default:var s=[];t.forEach((function(e){var t=Object.keys(e);n(e,t)&&(e=r(e,t)),s.push(e)})),e.where=s}},e.prototype.checkInsertQuery=function(e){var t=this.isInsertQryValid_(e),n=t.table,r=t.log;if(r)return r;if(!e.skipDataCheck){var o=new q(n,n.autoIncColumnValue).checkAndModifyValues(e.values),i=o.values,u=o.err;return e.values=i,u}},e}(),O=(d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),I=function(e){function t(t,n){var r=e.call(this)||this;return r.valuesAffected_=[],r.query=t,r.util=n,r.tableName=t.into,r}return O(t,e),t.prototype.execute=function(e){var t=this,n=new C(e).validate(u.Insert,this.query);return n?_(n):this.insertData_(e).then((function(e){return t.query.return?t.valuesAffected_:t.rowAffected})).catch((function(e){return t.util.abortTransaction(),_(e)}))},t.prototype.insertData_=function(e){var t,n,r,o=this;return n=this.query.return?function(e){o.valuesAffected_.push(e)}:function(e){++o.rowAffected},r=this.query.upsert?function(e){return t.put(e)}:function(e){return t.add(e)},this.isTxQuery||this.util.createTransaction([this.query.into,v.tableName]),t=this.util.objectStore(this.tableName),g(this.query.values.map((function(e){return p((function(t,o){var i=r(e);i.onerror=o,i.onsuccess=function(){n(e),t()}}))}))).then((function(){v.set(v.dbSchema,e,o.util)}))},t}(k),j=void 0===self.alert&&"undefined"==typeof ServiceWorkerGlobalScope,A=function(){try{if(indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),!indexedDB)return!1;IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange}catch(e){return!1}return!0}(),N=function(e){return Object.keys(e)},R=function(e){return Array.isArray(e)},Q=function(e){return N(e).length},D=function(e){for(var t in e)return t},L=function(){var e=this;this.query.case?this.pushResult=function(t){var n;for(n in e.thenEvaluator.setCaseAndValue(e.query.case,t),e.query.case)t[n]=e.thenEvaluator.setColumn(n).evaluate();e.results.push(t)}:this.pushResult=function(t){e.results.push(t)}},V=function(){this.query.limit&&(this.shouldEvaluateLimitAtEnd=!0),this.query.skip&&(this.shouldEvaluateSkipAtEnd=!0)},W=function(){var e=this.results;this.results=null;for(var t=this.primaryKey(),n={},r=0,o=e.length;r<o;r++)n[e[r][t]]=e[r];for(var r in e=[],n)e.push(n[r]);this.results=e},B=function(){function e(){}return e.prototype.setCaseAndValue=function(e,t){this.caseQuery_=e,this.setValue(t)},e.prototype.setCaseAndColumn=function(e,t){return this.caseQuery_=e,this.setColumn(t),this},e.prototype.setColumn=function(e){return this.columnName_=e,this.caseColumnQuery_=this.caseQuery_[this.columnName_],this.length_=this.caseColumnQuery_.length,this},e.prototype.setValue=function(e){return this.value=e,this},e.prototype.evaluate=function(){for(var e=0;e<this.length_;e++)if(!0===this.checkCase_(this.caseColumnQuery_[e]))return this.caseColumnQuery_[e].then;var t=this.caseColumnQuery_[this.length_-1].then;return null==t?this.value[this.columnName_]:t},e.prototype.checkCase_=function(e){var t;for(t in e){switch(t){case a.GreaterThan:if(this.value[this.columnName_]>e[t])return!0;break;case a.Equal:if(this.value[this.columnName_]===e[t])return!0;break;case a.LessThan:if(this.value[this.columnName_]<e[t])return!0;break;case a.GreaterThanEqualTo:if(this.value[this.columnName_]>=e[t])return!0;break;case a.LessThanEqualTo:if(this.value[this.columnName_]<=e[t])return!0;break;case a.NotEqualTo:if(this.value[this.columnName_]!==e[t])return!0;break;case a.Between:if(this.value[this.columnName_]>e[t].low&&this.value[this.columnName_]<e[t].high)return!0}return!1}},e}(),P=function(){var e,t=this;if(this.query.order&&!1!==this.query.order.idbSorting&&this.query.order.by){if(!this.objectStore.indexNames.contains(this.query.order.by))return _(new w(r.ColumnNotExist,{column:this.query.order.by,isOrder:!0}));var n=this.query.order.type&&"desc"===this.query.order.type.toLowerCase()?"prev":"next";this.sorted=!0,e=this.objectStore.index(this.query.order.by).openCursor(null,n)}else e=this.objectStore.openCursor();var o=function(){if(!1===t.shouldEvaluateLimitAtEnd&&!1===t.shouldEvaluateSkipAtEnd){if(t.skipRecord&&t.limitRecord)return U;if(t.skipRecord)return G;if(t.limitRecord)return K}return F}();return p((function(n,r){e.onerror=r,e.onsuccess=o.call(t,n)}))},U=function(e){var t,n=this,r=!1;return function(o){(t=o.target.result)?r&&n.results.length!==n.limitRecord?(n.pushResult(t.value),t.continue()):(r=!0,t.advance(n.skipRecord)):e()}},G=function(e){var t,n=this,r=!1;return function(o){(t=o.target.result)?r?(n.pushResult(t.value),t.continue()):(r=!0,t.advance(n.skipRecord)):e()}},F=function(e){var t,n=this;return function(r){(t=r.target.result)?(n.pushResult(t.value),t.continue()):e()}},K=function(e){var t,n=this;return function(r){(t=r.target.result)&&n.results.length!==n.limitRecord?(n.pushResult(t.value),t.continue()):e()}},J=function(e){return e.replace(/\s/g,"")},M=function(){if(this.query.distinct){var e=[],t=this.results[0];for(var n in t)e.push(n);var r=this.primaryKey(),o=e.indexOf(r);e.splice(o,1),this.query.groupBy=e.length>0?e:null}this.query.groupBy?this.query.aggregate?this.executeAggregateGroupBy():this.processGroupBy():this.query.aggregate&&this.processAggregateQry()},z=function(e){var t;if(null==this.query.join)t=this.getColumnInfo(e);else{var n=J(e).split(".");e=n[1],t=this.getColumnInfo(e,n[0])}if(null==t){var o=this.results[0][e];if(o)return{dataType:E(o),name:e};throw new w(r.ColumnNotExist,{column:e,isOrder:!0})}return t},$=function(e,t){return t.localeCompare(e)},H=function(e,t){return e.localeCompare(t)},X=function(e,t){return new String(t).localeCompare(e)},Y=function(e,t){return new String(e).localeCompare(t)},Z=function(e,t){return t-e},ee=function(e,t){return e-t},te=function(e,t){return t.getTime()-e.getTime()},ne=function(e,t){return e.getTime()-t.getTime()},re=function(e,t,n){for(var r in n){this.thenEvaluator.setCaseAndValue(n,e);var o=this.thenEvaluator.setColumn(r).evaluate();this.thenEvaluator.setCaseAndValue(n,t);var u=this.thenEvaluator.setColumn(r).evaluate();switch(typeof e[o]){case i.String:return $(e[o],t[u]);default:return Z(e[o],t[u])}}},oe=function(e,t,n){for(var r in n){this.thenEvaluator.setCaseAndValue(n,e);var o=this.thenEvaluator.setColumn(r).evaluate();this.thenEvaluator.setCaseAndValue(n,t);var u=this.thenEvaluator.setColumn(r).evaluate();switch(typeof e[o]){case i.String:return H(e[o],t[u]);default:return ee(e[o],t[u])}}},ie=function(e,t){switch(e.dataType){case i.String:return"asc"===t.type?H:$;case i.Number:return"asc"===t.type?ee:Z;case i.DateTime:return"asc"===t.type?ne:te;default:return"asc"===t.type?Y:X}},ue=function(e){var t,n=this;e.type=se(e.type);var r=e.by;if(null!=r&&typeof r===i.Object)"asc"===e.type?this.results.sort((function(e,t){return oe.call(n,e,t,r)})):this.results.sort((function(e,t){return re.call(n,e,t,r)}));else{var o=z.call(this,r);if(null!=o){var u=ie(o,e);r=o.name,null==e.case?this.results.sort((function(e,t){return u(e[r],t[r])})):(this.thenEvaluator.setCaseAndColumn(((t={})[r]=e.case,t),r),this.results.sort((function(e,t){return u(n.thenEvaluator.setValue(e).evaluate(),n.thenEvaluator.setValue(t).evaluate())})))}}},se=function(e){return null==e?"asc":e.toLowerCase()},ae=function(){var e=this.query.order;if(e&&this.results.length>0&&!this.sorted){var t=E(e);if(t===i.Object)ue.call(this,e);else if(t===i.Array){ue.call(this,e[0]);for(var n=function(t,n){var o=e[t-1].by,i=e[t],u=i.by,s=z.call(r,u);if(null!=s){u=s.name,i.type=se(i.type);var a=ie(s,i);r.results.sort((function(e,t){return e[o]===t[o]?a(e[u],t[u]):0}))}},r=this,o=1,u=e.length;o<u;o++)n(o)}}},ce=function(){var e,t=this.results,n=t.length,r={};this.results=void 0;var o=function(){var n=0;for(var r in t)n+=t[r][e]?1:0;return n},u=function(){var n=0;for(var r in t)n=n>t[r][e]?n:t[r][e];return n},s=function(){var n=1/0,r=1/0;for(var o in t)n=n<(r=t[o][e]?t[o][e]:1/0)?n:r;return n},a=function(){var n=0;for(var r in t)n+=t[r][e];return n},c=function(){var r=0;for(var o in t)r+=t[o][e];return r/n};for(var l in this.query.aggregate){var h=this.query.aggregate[l],f=E(h),p=void 0;switch(l){case"count":p=o;break;case"max":p=u;break;case"min":p=s;break;case"sum":p=a;break;case"avg":p=c}switch(f){case i.String:r[l+"("+(e=h)+")"]=p();break;case i.Array:for(var d in h)r[l+"("+(e=h[d])+")"]=p()}}for(var l in r)t[0][l]=r[l];this.results=[t[0]]},le=function(){var e=this.query.groupBy,t=this.results,n={};if(this.results=this.query.groupBy=null,E(e)!==i.Object)if(E(e)===i.String)for(var r in t)n[t[r][e]]=t[r];else{var o=void 0;for(var r in t){for(var u in o="",e)o+=t[r][e[u]];n[o]=t[r]}}else if(1===Object.keys(e).length){var s=D(e);for(var r in this.thenEvaluator.setCaseAndColumn(e,s),t)n[this.thenEvaluator.setValue(t[r]).evaluate()]=t[r]}else{o=void 0;for(var r in t){for(var u in o="",this.thenEvaluator.setCaseAndValue(e,t[r]),e)o+=this.thenEvaluator.setColumn(u).evaluate();n[o]=t[r]}}for(var r in t=[],n)t.push(n[r]);this.results=t},he=function(){var e=this.query.groupBy,t=this.results;this.results=void 0;var n,r,o,u,s={},c=this.query.aggregate,l=function(){var e=function(){return o=(o=s[r])?o["count("+u+")"]:0,o+=t[n][u]?1:0},l=function(){return o=(o=s[r])?o["max("+u+")"]:0,t[n][u]=t[n][u]?t[n][u]:0,o>t[n][u]?o:t[n][u]},h=function(){return o=(o=s[r])?o["min("+u+")"]:1/0,t[n][u]=t[n][u]?t[n][u]:1/0,o<t[n][u]?o:t[n][u]},f=function(){return o=(o=s[r])?o["sum("+u+")"]:0,o+=t[n][u]?t[n][u]:0},p=function(){var e=(o=s[r])?o["sum("+u+")"]:0;e+=t[n][u]?t[n][u]:0,t[n]["sum("+u+")"]=e,o=o?o["count("+u+")"]:0,o+=t[n][u]?1:0,t[n]["count("+u+")"]=o};for(var d in c){var y=c[d],v=E(y),b=void 0;switch(d){case a.Count:b=e;break;case a.Max:b=l;break;case a.Min:b=h;break;case a.Sum:b=f;break;case a.Avg:b=p}switch(v){case i.String:u=y,t[n][d+"("+u+")"]=b();break;case i.Array:for(var m in y)u=y[m],t[n][d+"("+u+")"]=b()}}};if(E(e)===i.String)for(n in t)r=t[n][e],l(),s[r]=t[n];else for(n in t){for(var h in r="",e)r+=t[n][e[h]];l(),s[r]=t[n]}for(var f in t=[],s)t.push(s[f]);if(c.avg)if(E(c.avg)===i.String)for(n in t){var p=t[n]["sum("+c.avg+")"],d=t[n]["count("+c.avg+")"];t[n]["avg("+c.avg+")"]=p/d,c.count!==c.avg&&delete t[n]["count("+c.avg+")"],c.sum!==c.avg&&delete t[n]["sum("+c.avg+")"]}else{var y=E(c.count)===i.String,v=E(c.sum)===i.String;for(n in t)for(var h in c.avg){var b=c.avg[h],m=t[n]["sum("+b+")"],g=t[n]["count("+b+")"];t[n]["avg("+b+")"]=m/g,y&&(c.count!==b||-1===c.count.indexOf(b))&&delete t[n]["count("+b+")"],v&&(c.sum!==b||-1===c.sum.indexOf(b))&&delete t[n]["sum("+b+")"]}}this.results=t},fe=function(e,t,n,r){var o=this;t=n?t[n]:t;var i=this.objectStore.index(e).openCursor(this.util.keyRange(t,n),r),u=function(){if(!1===o.shouldEvaluateLimitAtEnd&&!1===o.shouldEvaluateSkipAtEnd){if(o.skipRecord&&o.limitRecord)return pe;if(o.skipRecord)return de;if(o.limitRecord)return ye}return ve}();return p((function(e,t){i.onerror=t,i.onsuccess=u.call(o,e)}))},pe=function(e){var t=this,n=!1;return function(r){var o=r.target.result;if(o)if(n&&t.results.length!==t.limitRecord){var i=o.value;t.shouldAddValue(i)&&t.pushResult(i),o.continue()}else n=!0,o.advance(t.skipRecord);else e()}},de=function(e){var t=this,n=!1;return function(r){var o=r.target.result;if(o)if(n){var i=o.value;t.shouldAddValue(i)&&t.pushResult(i),o.continue()}else n=!0,o.advance(t.skipRecord);else e()}},ye=function(e){var t=this;return function(n){var r=n.target.result;if(r&&t.results.length!==t.limitRecord){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},ve=function(e){var t=this;return function(n){var r=n.target.result;if(r){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},be=function(e){var t,n,r=e.split("%");switch(r[1]?(t=r[1],n=r.length>2?l.Any:l.Last):(t=r[0],n=l.First),n){case l.First:return new RegExp("^"+t,"i");case l.Last:return new RegExp(t+"$","i");default:return new RegExp(""+t,"i")}},me=function(e){return"object"===E(e)&&!(e instanceof RegExp)},ge=function(e){if(me(e)){var t={};for(var n in e)t[n]=null!=e[n]&&me(e[n])?ge(e[n]):e[n];return t}return e},_e=function(e,t,n){var r=E(e);if(r!==E(t))return!1;switch(r===i.DateTime&&(e=e.getTime(),t=t.getTime()),n){case a.GreaterThan:return e>t;case a.LessThan:return e<t;case a.LessThanEqualTo:return e<=t;case a.GreaterThanEqualTo:return e>=t;case a.NotEqualTo:return e!==t;default:return e===t}},we=function(){function e(e,t){this.where=ge(e),this.checkFlag=t}return e.prototype.remove=function(e){var t=e.pop();delete e.reduce((function(e,t){return e&&e[t]}),this.where)[t]},e.prototype.check=function(e){var t=!0;if(!this.checkFlag)return t;for(var n in this.where){if(!t)return t;var r=this.where[n],o=e[n];if("object"===E(r))for(var i in r){if(!t)return t;switch(i){case a.In:t=this.checkIn(n,o);break;case a.Like:t=this.checkLike_(n,o);break;case a.Regex:t=this.checkRegex(n,o);break;case a.Between:case a.GreaterThan:case a.LessThan:case a.GreaterThanEqualTo:case a.LessThanEqualTo:case a.NotEqualTo:t=this.checkComparisionOp_(n,o,i);break;default:t=!1}}else t=_e(r,o)}return t},e.prototype.checkIn=function(e,t){return null!=this.where[e][a.In].find((function(e){return _e(e,t)}))},e.prototype.checkLike_=function(e,t){return be(this.where[e][a.Like]).test(t)},e.prototype.checkRegex=function(e,t){return this.where[e][a.Regex].test(t)},e.prototype.checkComparisionOp_=function(e,t,n){var r=this.where[e][n];return n!=a.Between?_e(t,r,n):_e(t,r.low,">=")&&_e(t,r.high,"<=")},e}(),xe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ke=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shouldEvaluateLimitAtEnd=!1,t.shouldEvaluateSkipAtEnd=!1,t}return xe(t,e),t.prototype.goToWhereLogic=function(){var e=this.query,t=D(e.where);if(!this.objectStore.indexNames.contains(t)){var n=this.getColumnInfo(t),o=new w(null==n?r.ColumnNotExist:r.EnableSearchOff,{column:t});return _(o)}var i=e.where[t];if("object"!==E(i)){u=Q(e.where)>1;return this.whereCheckerInstance=new we(e.where,u),this.whereCheckerInstance.remove([t]),this.executeWhereLogic(t,i,null,"next")}var u=Q(i)>1||Q(e.where)>1;this.whereCheckerInstance=new we(e.where,u);var s=D(i);switch(this.whereCheckerInstance.remove([t,s]),s){case a.Like:var c=be(i[a.Like]);return this.executeRegexLogic(t,c);case a.Regex:return this.executeRegexLogic(t,i[a.Regex]);case a.In:return this.executeInLogic(t,i[a.In]);case a.Between:case a.GreaterThan:case a.LessThan:case a.GreaterThanEqualTo:case a.LessThanEqualTo:return this.executeWhereLogic(t,i,s,"next");case a.Aggregate:break;default:return this.executeWhereLogic(t,i,null,"next")}},t}(k),Ee=function(e,t){var n=this,r=this.skipRecord,o=function(e){0===r?n.pushResult(e):--r},i=function(){if(!1===n.shouldEvaluateLimitAtEnd&&!1===n.shouldEvaluateSkipAtEnd){if(n.skipRecord&&n.limitRecord)return Te;if(n.skipRecord)return qe;n.limitRecord}return Se}(),u=this.objectStore.index(e);return g(t.map((function(e){return t=e,p((function(e,r){var s=u.openCursor(n.util.keyRange(t));s.onsuccess=i.call(n,e,o),s.onerror=r}));var t})))},Te=function(e,t){var n=this;return function(r){var o=r.target.result;if(n.results.length!==n.limitRecord&&o){var i=o.value;n.shouldAddValue(i)&&t(i),o.continue()}else e()}},qe=function(e,t){var n=this;return function(r){var o=r.target.result;if(o){var i=o.value;n.shouldAddValue(i)&&t(i),o.continue()}else e()}},Se=function(e){var t=this;return function(n){var r=n.target.result;if(r){var o=r.value;t.shouldAddValue(o)&&t.pushResult(o),r.continue()}else e()}},Ce=function(e,t){var n=this,r=this.skipRecord,o=function(e){0===r?n.pushResult(e):--r};this.shouldAddValue=function(e){return t.test(e.key)&&n.whereCheckerInstance.check(e.value)};var i=this.objectStore.index(e).openCursor(),u=function(){if(!1===n.shouldEvaluateLimitAtEnd&&!1===n.shouldEvaluateSkipAtEnd){if(n.skipRecord&&n.limitRecord)return Oe;if(n.skipRecord)return Ie;if(n.limitRecord)return je}return Ae}();return p((function(e,t){i.onerror=t,i.onsuccess=u.call(n,e,o)}))},Oe=function(e,t){var n=this;return function(r){var o=r.target.result;n.results.length!==n.limitRecord&&o?(n.shouldAddValue(o)&&t(o.value),o.continue()):e()}},Ie=function(e,t){var n=this;return function(r){var o=r.target.result;o?(n.shouldAddValue(o)&&t(o.value),o.continue()):e()}},je=function(e){var t=this;return function(n){var r=n.target.result;t.results.length!==t.limitRecord&&r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):e()}},Ae=function(e){var t=this;return function(n){var r=n.target.result;r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):e()}},Ne=function(){return(Ne=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Re=function(){return new Qe(this).execute().then((function(e){}))},Qe=function(){function e(e){this.joinQueryStack_=[],this.currentQueryStackIndex_=0,this.tablesFetched=[],this.results=[],this.select=e}return Object.defineProperty(e.prototype,"query",{get:function(){return this.select.query},enumerable:!1,configurable:!0}),e.prototype.getTable=function(e){return this.select.table(e)},e.prototype.executeSelect=function(e){return new We(e,this.select.util).execute(this.select.db)},e.prototype.execute=function(){var e=this,t=this.select.query;E(t.join)===i.Object?this.joinQueryStack_=[t.join]:this.joinQueryStack_=t.join;var n=t.from;return this.executeSelect({from:n,where:t.where,case:t.case,flatten:t.flatten}).then((function(t){return e.results=t.map((function(t){var n;return(n={})[e.currentQueryStackIndex_]=t,n})),e.tablesFetched.push(n),e.startExecutingJoinLogic_()}))},e.prototype.onJoinQueryFinished_=function(){var e=this;this.query;if(this.results.length>0)try{var t=[],n=Object.keys(this.results[0]).length,o=function(e,t){if(null!=e.as)for(var n in e.as)void 0===t[e.as[n]]&&(t[e.as[n]]=t[n],delete t[n]);return t};this.results.forEach((function(r){for(var i=r[0],u=1;u<n;u++){var s=e.joinQueryStack_[u-1];i=Ne(Ne({},i),o(s,r[u]))}t.push(i)})),this.select.results=t,this.select.setLimitAndSkipEvaluationAtEnd_(),this.select.query.flatten=null,this.select.processOrderBy(),this.select.processGroupDistinctAggr()}catch(e){return _(new w(r.InvalidJoinQuery,e.message))}},e.prototype.startExecutingJoinLogic_=function(){var e=this,t=this.joinQueryStack_[this.currentQueryStackIndex_];if(!t)return this.onJoinQueryFinished_();try{var n=this.getJoinTableInfo_(t.on);return t.with===n.table1.table&&(n={table1:n.table2,table2:n.table1}),this.executeSelect({from:t.with,where:t.where,case:t.case,flatten:t.flatten}).then((function(r){return e.jointables(t.type,n,r),e.tablesFetched.push(n.table2.table),++e.currentQueryStackIndex_,e.startExecutingJoinLogic_()}))}catch(e){return _(new w(r.InvalidJoinQuery,e.message))}},e.prototype.jointables=function(e,t,n){var r,o,i,u,s=this,a=[],c=t.table1.column,l=t.table2.column,h=this.tablesFetched.indexOf(t.table1.table),f=this.currentQueryStackIndex_+1;switch(e){case"left":i=0,u={},s.getTable(t.table2.table).columns.forEach((function(e){u[e.name]=null})),s.results.forEach((function(e){r=[],o=1===f?function(t){e[h][c]===t[l]&&r.push(t)}:function(t){var n=e[h];null!=n&&n[c]===t[l]&&r.push(t)},n.forEach(o),0===r.length&&(r=[u]),r.forEach((function(t){a[i]=Ne({},e),a[i++][f]=t}))}));break;default:!function(){var e=0;s.results.forEach((function(t){n.forEach((function(n){t[h][c]===n[l]&&(a[e]=Ne({},t),a[e++][f]=n)}))}))}()}this.results=a},e.prototype.getJoinTableInfo_=function(e){var t=(e=J(e)).split("="),n=t[0].split("."),r=t[1].split(".");return{table1:{table:n[0],column:n[1]},table2:{table:r[0],column:r[1]}}},e.prototype.checkJoinQuery_=function(e,t){var n,o=e.table1,i=e.table2,u=this.getTable(o.table),s=this.getTable(i.table);return t.with!==i.table&&(n=new w(r.InvalidJoinQuery,"on value should contains value of with")),null==u.columns.find((function(e){return e.name===o.column}))?n=new w(r.InvalidJoinQuery,"column "+o.column+" does not exist in table "+o.table):null==s.columns.find((function(e){return e.name===i.column}))&&(n=new w(r.InvalidJoinQuery,"column "+i.column+" does not exist in table "+i.table)),null==t.as&&(t.as={}),u.columns.every((function(e){var u=s.columns.find((function(t){return t.name===e.name&&t.name!==o.column}));return null==u||null!=t.as[u.name]||(n=new w(r.InvalidJoinQuery,"column "+e.name+" exist in both table "+o.table+" & "+i.table),!1)})),n},e}(),De=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Le=function(){return(Le=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ve=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},We=function(e){function t(t,n){var r=e.call(this)||this;return r.sorted=!1,r.isSubQuery=!1,r.thenEvaluator=new B,r.setLimitAndSkipEvaluationAtEnd_=V,r.setPushResult=L,r.removeDuplicates=W,r.executeWhereUndefinedLogic=P,r.executeJoinQuery=Re,r.processGroupDistinctAggr=M,r.processOrderBy=ae,r.processAggregateQry=ce,r.executeAggregateGroupBy=he,r.processGroupBy=le,r.executeInLogic=Ee,r.executeWhereLogic=fe,r.executeRegexLogic=Ce,r.returnResult_=function(){if(r.query.flatten){var e=[],t={};r.query.flatten.forEach((function(n){r.results.forEach((function(r,o){r[n].forEach((function(t){var o;e.push(Le(Le({},r),((o={})[n]=t,o)))})),t[o]=!0}))}));var n=0;N(t).forEach((function(e){r.results.splice(Number(e)-n,1),++n})),r.results=r.results.concat(e)}return r.processGroupDistinctAggr(),r.processOrderBy(),r.shouldEvaluateSkipAtEnd&&r.results.splice(0,r.query.skip),r.shouldEvaluateLimitAtEnd&&(r.results=r.results.slice(0,r.query.limit)),r.results},r.query=t,r.util=n,r.tableName=t.from,r.setPushResult(),R(r.query.where)?(r.isArrayQry=!0,r.setLimitAndSkipEvaluationAtEnd_()):(r.skipRecord=t.skip,r.limitRecord=t.limit),t.order?((R(t.order)||t.order.case||"object"==typeof t.order.by)&&(r.query.order.idbSorting=!1),r.setLimitAndSkipEvaluationAtEnd_()):t.groupBy&&r.setLimitAndSkipEvaluationAtEnd_(),r}return De(t,e),t.prototype.execute=function(e){var t;this.db=e;try{var n=new C(e).validate(u.Select,this.query);return n?_(n):(null==this.query.join?null!=this.query.where?(this.initTransaction_(),t=R(this.query.where)?this.processWhereArrayQry():this.processWhere_()):(this.initTransaction_(),t=this.executeWhereUndefinedLogic()):t=this.executeJoinQuery(),t.then(this.returnResult_.bind(this)))}catch(e){return this.onException(e)}},t.prototype.processWhereArrayQry=function(){var e=this;this.isArrayQry=!0;var t,n=this.query.where,r=this.primaryKey(),o=!0,i=[],u=function(){if(t===a.And){!0===o?i=e.results:i.length>0&&(u=[],e.results.forEach((function(e){var t;t=e[r],i.findIndex((function(e){return e[r]===t}))>=0&&u.push(e)})),i=u,u=null)}else i.length>0?(e.results=Ve(Ve([],i),e.results),e.removeDuplicates(),i=e.results):i=e.results;var u;if(o=!1,n.length>0)return e.results=[],s();e.results=i},s=function(){return e.query.where=n.shift(),e.query.where[a.Or]&&1===Q(e.query.where)?(t=a.Or,e.query.where=e.query.where[a.Or]):t=a.And,e.processWhere_().then(u)};return s()},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.tableName],c.ReadOnly),this.objectStore=this.util.objectStore(this.tableName)},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(t){return e.whereCheckerInstance.check(t)},this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=null,this.removeDuplicates()},t.prototype.orQuerySuccess_=function(){if(this.orInfo.results=Ve(Ve([],this.orInfo.results),this.results),!this.query.limit||this.query.limit>this.orInfo.results.length){this.results=[];var e=D(this.orInfo.orQuery);if(null!=e){var t={};return t[e]=this.orInfo.orQuery[e],delete this.orInfo.orQuery[e],this.query.where=t,this.goToWhereLogic().then(this.onWhereEvaluated.bind(this))}}return this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0;var e=this.query.where;this.orInfo={orQuery:e.or,results:[]},delete e.or},t}(ke),Be=function(){var e,t,n=this,r=n.objectStore.count?(e=n.objectStore.count(),function(t){return function(){n.resultCount=e.result,t()}}):(e=n.objectStore.openCursor(),function(e){return function(r){(t=r.target.result)?(++n.resultCount,t.continue()):e()}});return p((function(t,n){e.onerror=n,e.onsuccess=r(t)}))},Pe=function(e,t,n){var r,o,i=this;return t=n?t[n]:t,p((function(u,s){1===Q(i.query.where)&&i.objectStore.count?(r=i.objectStore.index(e).count(i.util.keyRange(t,n))).onsuccess=function(){i.resultCount=r.result,u()}:(r=i.objectStore.index(e).openCursor(i.util.keyRange(t,n))).onsuccess=function(e){(o=e.target.result)?(i.whereCheckerInstance.check(o.value)&&++i.resultCount,o.continue()):u()},r.onerror=s}))},Ue=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)},p((function(e,t){o.onerror=t,o.onsuccess=function(t){(n=t.target.result)?(r.shouldAddValue(n)&&++r.resultCount,n.continue()):e()}}))},Ge=function(e,t){var n,r=this,o=this.objectStore.index(e);return g(t.map((function(e){return t=e,i=r.util.keyRange(t),r.objectStore.count?p((function(e,t){var n=o.count(i);n.onsuccess=function(t){r.resultCount+=t.target.result,e()},n.onerror=t})):p((function(e,t){var u=o.openCursor(i);u.onsuccess=function(t){(n=t.target.result)?(r.whereCheckerInstance.check(n.value)&&++r.resultCount,n.continue()):e()},u.onerror=t}));var t,i})))},Fe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ke=function(e){function t(t,n){var r=e.call(this)||this;return r.resultCount=0,r.executeWhereUndefinedLogic=Be,r.executeWhereLogic=Pe,r.executeRegexLogic=Ue,r.executeInLogic=Ge,r.query=t,r.util=n,r.tableName=t.from,r}return Fe(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n=new C(e),r=this.query,o=n.validate(u.Count,r);if(o)return _(o);try{var i=void 0,s=function(){var n=new We(t.query,t.util);return n.isTxQuery=t.isTxQuery,n.execute(e).then((function(e){t.resultCount=e.length}))};return null==r.join?null!=r.where?r.where.or||R(this.query.where)?i=s():(this.initTransaction_(),i=this.goToWhereLogic()):(this.initTransaction_(),i=this.executeWhereUndefinedLogic()):i=s(),i.then((function(e){return t.resultCount}))}catch(e){this.onException(e)}},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from],c.ReadOnly),this.objectStore=this.util.objectStore(this.query.from)},t}(ke),Je=function(e,t){for(var n in e)if(E(e[n])!==i.Object)t[n]=e[n];else for(var r in e[n]){switch(r){case"+":t[n]+=e[n][r];break;case"-":t[n]-=e[n][r];break;case"*":t[n]*=e[n][r];break;case"/":t[n]/=e[n][r];break;case"{push}":t[n].push(e[n][r]);break;default:t[n]=e[n]}break}return t},Me=function(){var e=this,t=this.objectStore.openCursor(),n=this.query.set;return p((function(r,o){t.onsuccess=function(t){var i=t.target.result;if(i)try{var u=i.update(Je(n,i.value));u.onsuccess=function(){++e.rowAffected,i.continue()},u.onerror=o}catch(e){o(e)}else r()},t.onerror=o}))},ze=function(e,t){var n=this,r=this.objectStore.index(e),o=this.query;return g(t.map((function(e){return t=e,p((function(e,i){var u=r.openCursor(n.util.keyRange(t));u.onsuccess=function(t){var r=t.target.result;if(r){var u=r.value;if(n.whereCheckerInstance.check(u))try{var s=r.update(Je(o.set,u));s.onsuccess=function(){++n.rowAffected,r.continue()},s.onerror=i}catch(e){i(e)}else r.continue()}else e()},u.onerror=i}));var t})))},$e=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)};var i=this.query.set;return p((function(e,t){o.onsuccess=function(o){if(n=o.target.result)if(r.shouldAddValue(n))try{var u=n.update(Je(i,n.value));u.onsuccess=function(){++r.rowAffected,n.continue()},u.onerror=t}catch(e){t(e)}else n.continue();else e()},o.onerror=t}))},He=function(e,t,n){var r=this;t=n?t[n]:t;var o=this.objectStore.index(e).openCursor(this.util.keyRange(t,n)),i=this.query.set;return p((function(e,t){o.onsuccess=function(n){var o=n.target.result;if(o)if(r.whereCheckerInstance.check(o.value))try{var u=o.update(Je(i,o.value));u.onsuccess=function(){++r.rowAffected,o.continue()},u.onerror=t}catch(e){t(e)}else o.continue();else e()},o.onerror=t}))},Xe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ye=function(e){function t(t,n){var r=e.call(this)||this;return r.executeWhereUndefinedLogic=Me,r.executeInLogic=ze,r.executeRegexLogic=$e,r.executeWhereLogic=He,r.query=t,r.util=n,r.tableName=t.in,r}return Xe(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n=this.query;try{var r=new C(e).validate(u.Update,n);if(r)return _(r);this.initTransaction();return(null!=n.where?n.where.or||R(n.where)?this.executeComplexLogic_():this.goToWhereLogic():this.executeWhereUndefinedLogic()).then((function(){return t.rowAffected}))}catch(e){return this.onException(e)}},t.prototype.executeComplexLogic_=function(){var e=this,t=this.query,n=new We({from:t.in,where:t.where,ignoreCase:t.ignoreCase},this.util);return n.isTxQuery=this.isTxQuery,n.execute(this.db).then((function(n){var r,o,i=e.primaryKey(t.in),u=[];n.forEach((function(e){u.push(e[i])})),n=null;var s=((r={})[i]=((o={})[a.In]=u,o),r);return e.query.where=s,e.initTransaction(),e.goToWhereLogic()}))},t.prototype.initTransaction=function(){var e=this.query.in;this.isTxQuery||this.util.createTransaction([e]),this.objectStore=this.util.objectStore(e)},t}(ke),Ze=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),et=function(){return(et=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},tt=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r}return Ze(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n,r,o=this.query,i=0,u={},s={},a=!0,c=o.queries,l=c.length;if(c.every((function(e,t){return!(t+1<l&&e.from!==c[t+1].from)||(a=!1,!1)})),a){var h=this.primaryKey(c[0].from);n=function(e){return e[h]}}else n=function(e){var t="";for(var n in e)t+=e[n];return t};var f=function(){if(i<l)return(r=new We(c[i],t.util)).execute(t.db).then((function(e){return u={},e.forEach((function(e){var t=n(e);0===i?s[t]=e:null!=s[t]&&(u[t]=e)})),i>0&&(s=et({},u)),++i,f()}));var e,a=[],h=void 0,p=o.skip,d=o.limit,y=!1,v=function(){a.push(u[e])},b=function(){a.length<d?v():y=!0},m=function(e){0===p?e():--p};if(h=o.skip&&o.limit?function(){m((function(){b()}))}:o.limit?b:o.skip?function(){m((function(){v()}))}:function(){v()},d){for(e in u)if(h(e),y)break}else for(e in u)h(e);return r.results=a,Object.assign(r.query,{order:o.order,join:{}}),r.processOrderBy(),r.processGroupDistinctAggr(),r.results};return f()},t}(k),nt=function(){function e(){}return e.prototype.execute=function(e){return p((function(t,n){var o=indexedDB.deleteDatabase(e);o.onblocked=function(){var e=new w(r.DbBlocked);return n(x(e))},o.onerror=function(e){return n(x(e))},o.onsuccess=function(){t()}}))},e}(),rt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ot=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r}return rt(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n,r=this.query,o=0,i={},u=!0,s=r.length;if(r.every((function(e,t){return!(t+1<s&&e.from!==r[t+1].from)||(u=!1,!1)})),u){var a=this.primaryKey(r[0].from);n=function(e){return e[a]}}else n=function(e){var t="";for(var n in e)t+=e[n];return t};var c=function(){if(o<r.length)return new We(r[o++],t.util).execute(e).then((function(e){return e.forEach((function(e){i[n(e)]=e})),c()}));var u=[];for(var s in i)u.push(i[s]);return u};return c()},t}(k),it=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ut=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r.tableName=t.from,r}return it(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n=new C(e),r=this.query,o=n.validate(u.Remove,r);if(o)return _(o);try{this.initTransaction_();return(null!=r.where?R(r.where)?this.processWhereArrayQry():this.processWhere_():this.executeWhereUndefinedLogic()).then((function(){return t.rowAffected}))}catch(e){return this.onException(e)}},t.prototype.processWhereArrayQry=function(){var e=this,t=new We(this.query,this.util);return t.isTxQuery=this.isTxQuery,t.execute(this.db).then((function(t){var n,r,o=[],i=e.primaryKey(e.query.from);t.forEach((function(e){o.push(e[i])})),t=null;var u=((n={})[i]=((r={})[a.In]=o,r),n);return e.query[a.Where]=u,e.processWhere_()}))},t.prototype.processWhere_=function(){var e=this;return this.query.where.or&&this.processOrLogic(),this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from]),this.objectStore=this.util.objectStore(this.query.from)},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQuerySuccess_=function(){var e=this,t=D(this._orInfo.OrQuery);if(null!=t){var n={};return n[t]=this._orInfo.OrQuery[t],delete this._orInfo.OrQuery[t],this.query.where=n,this.goToWhereLogic().then((function(){return e.onWhereEvaluated()}))}this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0;var e=this.query.where;this._orInfo={OrQuery:e.or},delete e.or},t}(ke);ut.prototype.executeInLogic=function(e,t){var n=this;return g(t.map((function(t){return r=t,p((function(t,o){var i=n.objectStore.index(e).openCursor(n.util.keyRange(r));i.onsuccess=function(e){var r=e.target.result;r?(n.whereCheckerInstance.check(r.value)&&(r.delete(),++n.rowAffected),r.continue()):t()},i.onerror=o}));var r})))},ut.prototype.executeWhereUndefinedLogic=function(){var e,t=this,n=this.objectStore.openCursor();return p((function(r,o){n.onsuccess=function(n){(e=n.target.result)?(e.delete(),++t.rowAffected,e.continue()):r()},n.onerror=o}))},ut.prototype.executeWhereLogic=function(e,t,n){var r,o,i=this;return t=n?t[n]:t,o=this.objectStore.index(e).openCursor(this.util.keyRange(t,n)),p((function(e,t){o.onsuccess=function(t){(r=t.target.result)?(i.whereCheckerInstance.check(r.value)&&(r.delete(),++i.rowAffected),r.continue()):e()},o.onerror=t}))},ut.prototype.executeRegexLogic=function(e,t){var n,r=this,o=this.objectStore.index(e).openCursor();return this.shouldAddValue=function(e){return t.test(e.key)&&r.whereCheckerInstance.check(e.value)},p((function(e,t){o.onsuccess=function(t){(n=t.target.result)?(r.shouldAddValue(n)&&(n.delete(),++r.rowAffected),n.continue()):e()},o.onerror=t}))};var st=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),at=function(e){function t(t,n){var r=e.call(this)||this;return r.query=t,r.util=n,r.tableName=t,r}return st(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n=this.query;this.isTxQuery||this.util.createTransaction([n,v.tableName]);var r=this.util.objectStore(n).clear();try{return p((function(o,i){r.onsuccess=function(r){var u=t.table(n);for(var s in u.autoIncColumnValue)u.autoIncColumnValue[s]=0;v.set(v.dbSchema,e,t.util).then((function(){o()})).catch(i)},r.onerror=i}))}catch(e){return this.onException(e)}},t}(k),ct=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),lt=function(e){function t(t,n){var r=e.call(this)||this;return r.results={},r.reqQueue=[],r.isQueryExecuting=!1,r.isTxStarted_=!1,r.query=t,r.util=n,r}return ct(t,e),t.prototype.execute=function(e){var t=this;this.db=e;var n=this.validate();return n?_(n):(this.startExecution_(),p((function(e,n){t.onSuccess=e,t.onError=n})).then((function(e){return e})))},t.prototype.validate=function(){var e=this.query,t=this.notExistingTable_(e.tables);if(t)return new w(r.TableNotExist,{tableName:t});var n=e.method;return self[n]?void 0:new w(r.MethodNotExist,n)},t.prototype.startExecution_=function(){var e=this,t=this.query,n=t.method;return self[n].call(this,{data:t.data,insert:function(t){return e.pushReq_({name:u.Insert,query:t})},select:function(t){return e.pushReq_({name:u.Select,query:t})},update:function(t){return e.pushReq_({name:u.Update,query:t})},remove:function(t){return e.pushReq_({name:u.Remove,query:t})},count:function(t){return e.pushReq_({name:u.Count,query:t})},setResult:function(t,n){e.results[t]=n},getResult:function(t){return e.results[t]},abort:function(t){e.abortTx_(t)},start:function(){e.startTx_()}})},t.prototype.startTx_=function(){var e=this;try{this.isTxStarted_=!0;var t=this.query.tables;return t=t.concat(v.tableName),this.util.createTransaction(t).then((function(t){e.onSuccess(e.results)})).catch((function(t){e.onError(t)})),this.processExecutionOfQry_()}catch(e){this.onError(this.onException(e))}},t.prototype.onReqFinished_=function(e){var t=this.reqQueue.shift();t&&(e.error?(this.abortTx_("automatic abort of transaction due to error occured"),this.onError(e.error)):(this.isQueryExecuting=!1,t.onSuccess&&t.onSuccess(e),this.processExecutionOfQry_()))},t.prototype.abortTx_=function(e){this.reqQueue=[],this.util.abortTransaction()},t.prototype.executeRequest_=function(e){var t;this.isQueryExecuting=!0;var n=this.onReqFinished_.bind(this),r=e.query;switch(e.name){case u.Select:t=new We(r,this.util);break;case u.Insert:t=new I(r,this.util);break;case u.Update:t=new Ye(r,this.util);break;case u.Remove:t=new ut(r,this.util);break;case u.Count:t=new Ke(r,this.util)}t.isTxQuery=!0,t.execute(this.db).then(n).catch((function(e){n({error:e})}))},t.prototype.pushReq_=function(e){var t=this,n=function(){t.reqQueue.push(e)},r=p((function(t,n){e.onSuccess=function(e){t(e)},e.onError=function(e){n(e)}}));return!0===this.isTxStarted_?(n(),this.processExecutionOfQry_()):n(),r},t.prototype.processExecutionOfQry_=function(){!1===this.isQueryExecuting&&this.reqQueue.length>0&&this.executeRequest_(this.reqQueue[0])},t.prototype.notExistingTable_=function(e){var t=this,n=null;return e.every((function(e){return null!=t.table(e)||(n=e,!1)})),n},t}(k),ht=function(){function e(e){this.onQryFinished=j?function(e){self.postMessage(e)}:e}return e.prototype.run=function(e){var t,n=this;switch(e.name){case u.OpenDb:t=this.openDb(e.query);break;case u.InitDb:t=this.initDb(e.query);break;case u.CloseDb:t=this.closeDb();break;case u.Insert:t=this.insert(e.query);break;case u.Select:t=this.select(e.query);break;case u.Count:t=this.count(e.query);break;case u.Update:t=new Ye(e.query,this.util).execute(this.db);break;case u.Intersect:t=new tt(e.query,this.util).execute(this.db);break;case u.DropDb:t=this.dropDb();break;case u.Terminate:t=this.terminate();break;case u.Union:t=new ot(e.query,this.util).execute(this.db);break;case u.Remove:t=new ut(e.query,this.util).execute(this.db);break;case u.Clear:t=new at(e.query,this.util).execute(this.db);break;case u.Transaction:t=new lt(e.query,this.util).execute(this.db);break;case u.Get:t=v.get(e.query,this.util);break;case u.Set:var o=e.query;t=v.set(o.key,o.value,this.util);break;case u.ImportScripts:t=p((function(t,n){try{importScripts.apply(void 0,e.query),t()}catch(e){n(new w(r.ImportScriptsFailed,e.message))}}));break;default:0,t=Promise.resolve()}t.then((function(e){n.returnResult_({result:e})})).catch((function(e){var t={error:x(e)};n.returnResult_(t)}))},e.prototype.returnResult_=function(e){this.util&&this.util.emptyTx(),this.onQryFinished(e)},e.prototype.dropDb=function(){var e=this.db.name;return this.terminate().then((function(){return(new nt).execute(e)}))},e.prototype.closeDb=function(){return null==this.util?Promise.resolve():this.util.close()},e.prototype.terminate=function(){var e=this;return this.closeDb().then((function(){e.db=e.util=null}))},e.prototype.openDb=function(e){var t=this;return(this.db&&e.name===this.db.name?this.initDb():this.initDb({name:e.name,tables:[],version:e.version})).then((function(){return t.db}))},e.prototype.initDb=function(e){var t=this;if(!A)return _(new w(r.IndexedDbNotSupported));var n=e?new b(e):this.db;this.util=new m(n);return p((function(e,r){t.util.initDb().then((function(e){return e||(r=e,p((function(e,o){v.get(v.dbSchema,t.util).then((function(i){var u,s=!1;if(i&&(u=i.version,i.tables.forEach((function(e,t){var r=n.tables[t];r&&(e.version<r.version?(r.state=f.Delete,s=!0,u<r.version&&(u=r.version)):r.state=null)}))),s)return n.version=u,void t.terminate().then((function(r){t.util=new m(n),t.util.initDb().then((function(t){e(t)})).catch(o)}));r||(t.db=i),e(r)}))})));var r})).then((function(r){r?v.set(v.dbSchema,n,t.util).then((function(){t.db=n,e(!0)})):e(!1)})).catch(r)}))},e.prototype.insert=function(e){return new I(e,this.util).execute(this.db)},e.prototype.select=function(e){return new We(e,this.util).execute(this.db)},e.prototype.count=function(e){return new Ke(e,this.util).execute(this.db)},e}();if(j){var ft=new ht;self.onmessage=function(e){ft.run(e.data)}}}});
//# sourceMappingURL=jsstore.worker.min.js.map