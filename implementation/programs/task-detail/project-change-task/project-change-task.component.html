<nz-spin [nzSpinning]="changeLoading">
  <div class="task-wbs">
    <!--  项目变更任务 -->
    <nz-tabset
      *ngIf="wbsService.projectChangeDoc?.change_type"
      nzType="card"
      [nzTabBarExtraContent]="extraTemplate"
      [nzSelectedIndex]="tabIndex"
      [nzAnimated]="false"
      (nzSelectedIndexChange)="changeIndex($event)"
    >
      <nz-tab
        *ngIf="wbsService.projectChangeDoc.change_type === '2'"
        #tab
        nzTitle="{{ 'dj-default-计划维护' | translate }}"
        (nzSelect)="tabClickHandle('app-dynamic-wbs')"
      >
        <app-dynamic-wbs
          *ngIf="wbsService.projectInfo?.project_no"
          [source]="Entry.projectChange"
          [changeConfigData]="changeConfigData"
          (refreshPageChange)="refreshPage()"
          (changeLoading)="changeLoadingHandle($event)"
          [tabName]="tabName"
          [tabIndex]="tabIndex"
          [hasAuth]="hasAuth"
          #wbsComponent
        ></app-dynamic-wbs>
      </nz-tab>
      <nz-tab
        #tab
        nzTitle="{{ 'dj-pcc-专案基础信息维护' | translate }}"
        (nzSelect)="tabClickHandle('app-project-creation')"
      >
        <ng-container *ngIf="startInitProjectCreation">
          <app-project-creation
            *ngIf="wbsService.projectInfo?.project_no"
            [potentialStatus]="wbsTabsService.potentialStatus"
            [tabName]="tabName"
            [tabIndex]="tabIndex"
            [hasAuth]="hasAuth"
            [source]="Entry.projectChange"
            [hasAuth]="hasAuth"
            (successTransfer)="successTransfer($event)"
            (changeConfig)="changeConfig($event)"
            #creationComponent
          ></app-project-creation>
        </ng-container>
      </nz-tab>
      <nz-tab
        *ngIf="wbsService.projectChangeDoc?.change_type !== '1'"
        #tab
        nzTitle="{{ 'dj-default-参与部门人员' | translate }}"
        (nzSelect)="tabClickHandle('app-list-of-department')"
      >
        <ng-container *ngIf="startInitListOfDepartment">
          <app-list-of-department
            *ngIf="wbsService.projectInfo?.project_no"
            [executeContext]="model.content?.executeContext"
            [tabIndex]="tabIndex"
            [tabName]="tabName"
            [hasAuth]="hasAuth"
            [source]="Entry.projectChange"
            #listOfDep
          ></app-list-of-department>
        </ng-container>
      </nz-tab>
    </nz-tabset>

    <div class="submit-btn-box" *custAuthBtnByShare="hasAuth">
      <!-- [nzLoading]="isLoading" -->
      <button
        [ngClass]="[
          'submit-button',
          wbsService.projectChangeDoc?.change_status === '1' ? 'active' : ''
        ]"
        nz-button
        nzType="primary"
        (click)="callProjectTeamworkHandle()"
      >
        {{ 'dj-default-提交' | translate }}
      </button>
    </div>
    <ng-template #extraTemplate>
      <!-- 基本信息维护和参与人员右上角保存按钮 -->
      <ng-container>
        <div class="header-btn-box" *custAuthBtnByShare="hasAuth">
          <div
            [ngClass]="[
              'reset-project-info',
              wbsService.projectChangeDoc?.change_status !== '1' ? 'disabled' : ''
            ]"
            (click)="callResetProjectInfo()"
          >
            {{ 'dj-default-重置项目变更信息' | translate }}
          </div>
          <!--  class="project-info-delete" -->
          <div
            [ngClass]="[
              'project-info-delete',
              wbsService.projectChangeDoc?.change_status !== '1' ? 'disabled' : ''
            ]"
            (click)="callProjectInfoDelete()"
          >
            {{ 'dj-default-项目变更删除' | translate }}
          </div>
          <span
            #btnMockA
            *ngIf="tabName === 'app-project-creation' && creationComponent"
            class="btn-mock"
            [ngClass]="{
              active:
                creationComponent.isActive() &&
                creationComponent.hasSubmit &&
                wbsService.projectChangeDoc?.change_status === '1'
            }"
            (click)="saveBaseInfoAndPersonnelInfo(btnMockA.className.includes('active'))"
          >
            <svg
              class="save-icon"
              t="1694143480272"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="28273"
              width="200"
              height="200"
            >
              <path
                d="M720.457143 73.142857a29.257143 29.257143 0 0 1 21.942857 9.947429l128 145.92a29.257143 29.257143 0 0 1 7.314286 19.309714V877.714286a73.142857 73.142857 0 0 1-73.142857 73.142857H219.428571a73.142857 73.142857 0 0 1-73.142857-73.142857V146.285714a73.142857 73.142857 0 0 1 73.142857-73.142857h501.028572zM292.571429 146.285714h-43.885715a29.257143 29.257143 0 0 0-29.257143 29.257143v672.914286c0 16.091429 13.165714 29.257143 29.257143 29.257143h526.628572a29.257143 29.257143 0 0 0 29.257143-29.257143V272.091429a29.257143 29.257143 0 0 0-7.753143-19.748572L707.510857 155.574857A29.257143 29.257143 0 0 0 686.006857 146.285714H585.142857v182.857143a36.571429 36.571429 0 0 1-36.571428 36.571429h-219.428572a36.571429 36.571429 0 0 1-36.571428-36.571429V146.285714z m182.857142 512a36.571429 36.571429 0 0 1 0 73.142857h-146.285714a36.571429 36.571429 0 0 1 0-73.142857h146.285714z m219.428572-146.285714a36.571429 36.571429 0 0 1 0 73.142857h-365.714286a36.571429 36.571429 0 0 1 0-73.142857h365.714286zM512 146.285714H365.714286v146.285715h146.285714V146.285714z"
                p-id="28274"
              ></path>
            </svg>
            {{ 'dj-pcc-保存' | translate }}
          </span>
        </div>
      </ng-container>
    </ng-template>
  </div>
</nz-spin>
<ng-template #modalBodyForSubmit>
  <div class="submit-modal-class">
    <div>{{ 'dj-default-是否确认提交任务？' | translate }}</div>
    <div>{{ 'dj-default-注意：提交前请确保修改内容已保存！' | translate }}</div>
  </div>
</ng-template>
